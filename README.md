# esgf_wms

This repo contains scripts to parse THREDDS catalogs generated by the ESGF publisher and produce:
* NcML aggregations
* THREDDS catalog to go on WMS server
* THREDDS catalog to do on main data node, with links to WMS server

## Usage

Install requirements with `pip install -r requirements.txt` (create and activate a python 2.7 virtualenv first).

Create directories `input_catalogs`, `output_catalogs`, `output_catalogs_for_data_node` and `aggregations`.

* Run `python add_wms_for_data_node.py -a` to read the catalogs in `input_catalogs` and write the modified catalogs to `output_catalogs_for_data_node`.
* Similarly, run `python add_wms_for_wms_server.py -a` to write catalogs and aggregations to `output_catalogs` and `aggregations` respectively.

The code assumes that the files created in `aggregations` will be placed under `/esg/content/thredds/esgcet/aggregations` on the live WMS server.

## Tests

`tests.py` contains some *very simple* tests - to run use `pytest tests.py`.

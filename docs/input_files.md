# Input files

## Input CSV

The file given to `publish.sh` is a CSV file with the following header row:

```
ESGF DRS,No of files,Tech note URL,Tech note title,Aggregate,Include in WMS,JSON file
```

Each row corresponds to a dataset to be published. Boolean values should be
'Yes' or 'No'.

The referenced JSON files should be in ['CSV JSON'](#csv-json) format.

## CSV JSON

The JSON files referenced in the CSV should be of the following form:

```json
{
   "<DRS>.v<version>": [
       {
           "file": "<path>",
           "size": "<size in bytes>",
           "mtime": "<mtime>",
           "sha256": "<checksum>"
       },
       ...
   ],
   ...
}
```

This is the format produced by
[cci-tagger](https://github.com/cedadev/cci-tagger) (it is used because files
exist in this format for previously published datasets).

## Dataset JSON

These JSON files are generated by combining the CSV and the JSON files
referenced within it. This format is used by most of the python scripts in the
`esacci-esgf` package in order to work from a single file with all the
necessary information.

```json
{
   "<DRS>.v<version>": {
       "generate_aggregation": <boolean>,
       "include_in_wms": <boolean>,
       "tech_note_url": "<url>",
       "tech_note_title": "<title>",
       "files": [
           {
               "path": "<path>",
               "size": "<size in bytes>",
               "mtime": "<mtime>",
               "sha256": "<checksum>"
           },
           ...
       ]
   },
   ...
}
```

There is a script `merge_csv_json` that creates JSON of this form from a CSV
file.

**Note**: the path to the dataset file is under `file` in CSV JSON but under
`path` in this format.
